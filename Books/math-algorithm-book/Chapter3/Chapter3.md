# 基本的なアルゴリズム

## 3.1 素数判定法

#### 単純な素数判定法
$2$〜$N-1$まで割り切れるかを計算<br>
計算量→$O(N)$

#### 高速な素数判定法
$2$~$\sqrt{N}$まで割り切れるかを計算<br>
（全ての合成数は2以上$\sqrt{N}$以下のいずれかの整数で割り切れる<br>
計算量→$O(\sqrt{N})$


##### なぜ$\sqrt{N}$まででいいのか？

背理法を用いて正当性を証明：<br>

事実$F$: $N$が合成数であれば、$2$以上$\sqrt{N}$以下の約数が存在する

1. 事実$F$が成り立たないと仮定する
（$N$が合成数であり、$1$以上で最小の$N$の約数$A$が$\sqrt{N}$を超えていると仮定する）

2. 約数の性質より、$A \times B = N$ となる正の整数$B$が存在する（$B$は$N$の約数である）

3. しかし、$2.$  は $B = N /A < \sqrt{N}$ である。これは$2$以上の最小の約数が$A$であることに矛盾する

4. よって仮説は成り立たず、事実$F$が正しい


#### 応用例：約数列挙

1. $i = 1,2,3,\cdots,\sqrt{N}$について、$N$が$i$で割り切れるかどうかを調べる
2. 割り切れる場合、$i$と$N/i$を約数に追加する


## 3.2 ユークリッドの互除（ごじょ）法

自然数$A$と$B$の最大公約数を計算量$O(\log{(A+B)})$で求められる方法

#### 単純な方法
自然数$A$と$B \space (A \leq B)$において、$1,2,..,A$それぞれについて、$A$,$B$の両方が割り切れるかどうかを調べる<br>
→$2 \times min(A,B)$回計算を行う(最初の$2$=$A,B$それぞれに余りの計算を行うため)

#### 効率的な方法：ユークリッドの互除法
自然数$A$と$B \space (A \leq B)$において、
1. 大きい方の数を"大きいほうを小さい方で割った余り"に置き換えるという操作<br>（$max(A,B) = max(A,B)\space \% \space min(A,B)$  ※この書き方はできない）を繰り返す
2. 片方が$0$になったら操作を終了する。もう一方の数が最大公約数となる。

#####　なぜユークリッドの互除法で最大公約数が求められるのか？

**→１回の操作で２つの数の最大公約数は変化しないため**<br>

証明:<br>
ユークリッドの互除法で最大公約数が求められることを証明するために、<br>

まず２つの整数$A,B (A \geq B > 0)$について、$A\%B=r$とするとき<br>
$A$と$B$の最大公約数と$B$と$r$の最大公約数は等しいことを証明する。

$A$と$B$の最大公約数を$G$とすると、
$$A = aG,B = bG（a,b：互いに素）\tag{1}$$
$$A = BQ+r  \tag{2}$$

$(2)$に$(1)$を代入して整理すると、$G(a-bQ) = r$<br>
また、$a-bQ=r'$とおくと$Gr'=r$

よって$B$と$r$は$G$を公約数に持つ。<br>
また、$(2)$より$B$は$r$は$G$より大きな公約数を持たないので、$B$と$r$の最大公約数は$G$である。<br>

よって、ユークリッドの互除法の操作を何回行っても割られる数と割る数の最大公約数と割る数とあまりの最大公約数は一致し、割られる数が割り切れた時の割る数は最大公約数である。


#####　なぜ計算量が$\log$になるのか？

**→１回の操作で$A+B$の値が必ず$2/3$倍以下に減るため**<br>

証明：<br>

最初に与えられた$A,B \space (A \geq B > 0)$について$A+B=S$とおく

$A$と$B$の差について以下のように場合分けをすると次のことがわかる
1. 差が２倍未満のとき、操作によって$A+B$の値は$3B$未満から$B$だけ減る
2. 差が２倍以上のとき、操作によって$A+B$の値は$3B$以上から$2B$未満に減る

これらより両方の場合において、１回の操作で$(A+B)$の値は$\frac{2}{3}S$以下に減ることがわかる


操作を$L$回行った場合、$A+B$の値は$(\frac{2}{3})^{L}\times S$以下となる<br>
$A+B$の値は$1$未満にはならないので、操作回数が$L$の時、<br>
$$(\frac{2}{3})^{L}\times S \geq 1 \Leftrightarrow　L \leq log_{1.5}{S} $$

よって計算量は$O(\log{S}) = O(\log{(A+B)})$となる

#### ３個以上の数の最大公約数

N個の整数の最大公約数を求めるとき、
1. ある２個の数の最大公約数を求める
2. 1.で求めた最大公約数と1.で用いた以外の数の最大公約数を求める
3. 2.を$N-3$回繰り返して$N$個の数字の最大公約数を求める

#### ユークリッドの互除法を用いた最小公倍数の求め方

#####　２個の数の最小公倍数
２つの自然数$A,B$の最大公約数を$D$,最小公倍数を$M$とすると、
$$A \times B = D \times M$$

よって、ユークリッドの互除法で最大公約数$D$を求めたのち、$D$で$A\times B$を割れば求められる


#####　3個以上の数の最小公倍数
N個の整数の最小公倍数を求めるとき、
1. ある２個の数の最小公倍数を求める
2. 1.で求めた最小公倍数と1.で用いた以外の数の最小公倍数を求める
3. 2.を$N-3$回繰り返して$N$個の数字の最小公倍数を求める

**３個以上の数の最大公約数の場合と同じ手順で求められる**


## 3.3 場合の数とアルゴリズム

#### 場合の数の公式

###### 積の法則

$N$個の事象それぞれについて、事象$i\space (1\leq i \leq N)$の起こり方が$A_{i}$通りあるとする。<br>
全ての事象の組み合わせの数は$A_{1} \times A_{2} \times \cdots \times A_{N}$通りであり、組み合わせの数を掛け算で求められることを積の法則という。

特に、$N$個のモノの選び方は$2^{N}$通りである（モノ$i$を選ぶ選び方がYes/Noの２通りなので）

###### 並び替え

$n$個のモノを並び替える方法は
$$n! = n \times (n-1) \times \cdots \times 2 \times 1$$通りある。

###### 選択（組み合わせ）
$n$個のモノから$r$個のモノを選ぶ方法は
$${}_n C_r = \frac{n!}{r!(n-r)!} $$

${}_n C_r $を二項係数という


###### 選択＋並び替え（順列）
$n$個のモノから$r$個のモノを選び、それを並び替える方法は
$${}_n P_r = \frac{n!}{(n-r)!} = n \times (n-1) \times \cdots \times (n-r+1)$$

選んだ上で並び替えたので、
$${}_n P_r = r! \times {}_n C_r$$

#### 場合の数のアルゴリズム

例１<br>
```
問題文
コンビニにはN個の品物が売られており、i番目（1≤i≤N）の商品の値段は 
Ai円です。異なる2つの品物を買う方法のうち、合計金額が500円となるものは何通りありますか。

制約
2≤N≤200000
Aiは 100,200,300,400 のいずれか
入力はすべて整数
```
方法１：全探索<br>
選び方が${}_N C_2$で計算量が$O(N^{2})$となるので効率が悪い

方法２：条件から逆算<br>
２つで合計金額が500円となる商品の選び方は
- X: 100円の商品1つと400円の商品1つ
- Y: 200円の商品1つと300円の商品1つ

の２つのみ

100円、200円、300円、400円の商品の数をそれぞれ$a,b,c,d$とするとき、積の法則より
- X: $a$通り$\times d$通り$= ad$通り
- Y: $b$通り$\times c$通り$= bc$通り

よって答えは$ad+bc$通り


例２<br>
```
問題文
N枚のカードがあり、左からi番目（1≤i≤N）のカードの色はAiです。 
Ai=1 のとき赤色、Ai=2 のとき黄色、Ai=3 のとき青色です。
同じ色のカードを2枚選ぶ方法は何通りありますか。

制約
2≤N≤500000
1≤Ai≤3
入力はすべて整数
```

方法１：全探索<br>
計算量が$O(N^{2})$となるので効率が悪い

方法２：条件から逆算<br>
赤色、黄色、青色のカードの枚数をそれぞれ$x,y,z$とすると、
- 赤色のカードを2枚選ぶ方法は${}_x C_2$通り
- 黄色のカードを2枚選ぶ方法は${}_y C_2$通り
- 青色のカードを2枚選ぶ方法は${}_z C_2$通り

よって答えは$${}_x C_2 + {}_y C_2 + {}_z C_2 = \frac{x(x-1)}{2}+ \frac{y(y-1)}{2}+ \frac{z(z-1)}{2}$$
通り（計算量$O(N)$）

例３<br>
```
問題文N枚のカードがあり、左からi番目のカードには整数Aiが書かれています。
カードを5枚選ぶ方法のうち、選んだカードに書かれた整数の和がちょうど1000となるものは何通りありますか。

制約
5≤N≤100
1≤Ai≤1000
入力はすべて整数
```

方法：全探索<br>
計算量が$O(N^{5})$であり、$N=100$（最大）で単純計算すると$100^{5} = 10^{10}$となるので一見効率がやばい悪い<br>

しかし
$${}_{100} C_5 = \frac{100 \times 99 \times 98 \times 97 \times 96}{5 \times 4 \times 3 \times 2 \times 1} = 75287520 \sim 8\times10^{7}$$

実行制限時間が 5sec なので多分いける（よく見るのは 2sec）<br>

※ (2022-02-18)<br>
Python3.8.2で出すとTLE!!PyPy3で出すこと!!（動的計画法で書けば余裕で通るようだ）



## 3.4 確率・期待値とアルゴリズム

#### 確率とは
事象の起こりやすさを数値で表したもの<br>
$$P(A) = \frac{M}{N}$$
現状でこれ以上説明しようとしたら私は死にます（2022-02-18）

#### 期待値とは
$i$番目の結果$x_{i}$が起こる確率を$p_{i}$としたとき、
$$\sum_{i=1}^{N} p_{i}x_{i} = p_{1}x_{1} + p_{2}x_{2} + \cdots + p_{N}x_{N} $$

######　期待値の線形性
$N$回の試行を行い、$i$番目の試行の結果を$X_{i}$、期待値を$E[X_{i}]$とするとき、全ての結果の期待値の合計は$E[X_{1}] + E[X_{2}] + \cdots + E[X_{N}]$となる



例:<br>
```
問題文
ある国語のテストの問題はN問からなり、すべて選択式問題です。
i問目(1≤i≤N)はPi個の選択肢から1つの正解を選ぶ形式であり、配点はQi点です。
太郎君はまったく手がかりがつかめなかったので、全部の問題をランダムに回答することにしました。太郎君が得られる点数の期待値を計算してください。

制約
1≤N≤50
2≤Pi≤9
1≤Qi≤200
入力はすべて整数
```

方法１：全探索<br>
1. N問のうち正解した問題を選ぶ
2. それぞれ問題の期待値を計算
3. 集計

1.の段階で、正誤の組み合わせが$2^{N}$**←もう計算量考えたくない**

方法２：期待値の線形性を用いる<br>
期待値の線形性より、合計点数の期待値は各問題の点数の期待値の総和と等しい<br>
**組み合わせを全探索しなくても解ける!!!**

問題3.4.3

期待値の線形性より、全種類を集めるのにかかる回数の期待値は
- 0種類から1種類にするのにかかる回数の期待値
- 1種類から2種類にするのにかかる回数の期待値
-   :
- N-1種類からN種類にするのにかかる回数の期待値

$r$種類のコインが集まっている状態から$r+1$種類目のコインを集めるとき、すでに集めているコインを取る確率は$r/N$

回数の期待値は
$$ 1 + (\frac{r}{N})^{1} + (\frac{r}{N})^{2} + \cdots  + (\frac{r}{N})^{N-1}  = (\frac{N}{N-r})$$



※初項$a$,公比$r$の無限等比級数 $ar, ar^{2},\cdots ,ar^{n}, \cdots$の和は$$\frac{a(1-r^{n})}{1-r}$$

証明:<br>
$S_{n} = ar + ar^{2} + \cdots + ar^{n} +  \cdots$とすると、
$$ S_{n} - rS_{n} =  ar - ar^{n+1}\\
(1-r)S_{n} = a (1 - r^{n})\\
S_{n} = \frac{a(1-r^{n})}{1-r}$$





今回、$a=1$、$r/N$は1より小さく$(r/N)^{n}$は収束するため$\frac{N}{N-r}$となる


全体の回数の期待値は$r=0,1,2,\cdots,N-1$それぞれを代入して足し合わせた

$$ \frac{N}{N} + \frac{N}{N-1} + \frac{N}{N-2} + \cdots + \frac{N}{2}  + \frac{N}{1}  $$

となる

## 3.5 モンテカルロ法〜統計的な考え〜

**モンテカルロ法**

ある物事の成功率を推測する際に、$n$回のランダムな試行を行う。そのうち$m$回成功した場合、理論上の成功率が$\frac{m}{n}$であるとみなして近似するアルゴリズムの一種

この手法は試行回数$n$を増やすほど精度が良くなる。


#### 平均・標準偏差

- 平均$\mu$：データの平均的な値

$$\mu = \frac{x_{1} + x_{2} + \cdots + x_{N}}{N}$$

- 標準偏差$\sigma$：データの散らばり具合
$$ \sigma = \sqrt{\frac{(x_{1}-\mu)^{2} + (x_{2}-\mu)^{2} + \cdots + (x_{N}-\mu)^{2}  }{N}}$$


#### 正規分布


```python {cmd=true matplotlib=true}
import matplotlib.pyplot as plt
import numpy as np


x = np.linspace(-3,3,101)
y = np.exp(-x**2/2)/np.sqrt(2*np.pi)


plt.plot(x,y)
plt.xticks([-3,-2,-1,0,1,2,3],["μ-3σ","μ-2σ","μ-σ","μ","μ+σ","μ+2σ","μ+3σ"])
plt.yticks([])
# 68%
plt.fill_between(x,y,where=(-1<x)&(x<1),color="black",alpha=0.5)
# 95%
plt.fill_between(x,y,where=(-2<x)&(x<2),alpha=0.5)
plt.show()

```

- $\mu-\sigma$以上$\mu+\sigma$以下の範囲に全体の約68%が含まれる
- $\mu-2\sigma$以上$\mu+2\sigma$以下の範囲に全体の約95%が含まれる
- $\mu-3\sigma$以上$\mu+3\sigma$以下の範囲に全体の約99.7%が含まれる


#### モンテカルロ法の理論検証

$n$が十分大きい値である場合、確率$p$で成功する試行を$n$回行ったときに成功したものの割合は<br>平均$\mu = p$、標準偏差$\sigma = \sqrt{p(1-p)/n} $の正規分布で近似できる


中心極限定理たるものの特殊な場合らしい


試行回数を100倍（$100n$）に増やすと、標準偏差$\sigma = \sqrt{p(1-p)/n} $より誤差は10分の一になる


<br>

応用例:円周率$\pi$の近似値の計算<br>
1. 一辺が1 cmの正方形の中に$n$個の点をランダムな位置に打つ
2. 左下角を中心とする半径1 cmの円内に入った点の個数を$m$とする
3. $\frac{4m}{n}$を円周率$\pi$の近似値とする



節末問題あとで解いておいてください(2022-02-21のたこいより)<br>
[解答](https://github.com/E869120/math-algorithm-book/blob/main/editorial/chap3-5/chap3-5.pdf)



## 3.6 ソートと再帰の考え


#### 選択ソート
まだ調べていない中で最も小さい数を探すことを繰り返すソート

手順:<br>
$N$個の要素からなる配列$A \space (A_{1},A_{2}, \cdots , A_{N})$をソートするとき、<br> $i \space (1 \leq i \leq N-1, \space i++)$ 番目の要素$A_{i}$に対して、

1. $A_{i}\sim A_{N}$の中で最小の要素$A_{min}$を探す
2. $A_{i}$と$A_{min}$を交換する

$i = N-1$までこの操作を繰り返すことで配列$A$は小さい順でソートされる


計算量が$O(N^{2})$なので効率は良くない


#### 再帰

**再帰　それはたこいさんの天敵**

###### 再帰的定義の例１：階乗
```
def func(N):
    if N == 1:
        return 1
    else:
        return func(N-1) * N
```

###### 再帰的定義の例２：ユークリッドの互除法


```
def gcd(a,b):
    if b == 0:
        return a
    else:
        gcd(b,a%b)

```


###### 再帰的定義の例3：分割統治法で合計値を求める

**再帰関数内で２回以上の再帰呼び出しを行うことも可能**

例：$N$個の整数$A_{1},A_{2}, \cdots , A_{N}$の合計
```
def solve(l,r):
    if r - l == 1:
        return A[l]
    else:
        m = (l+r)//2
        s1 = solve(l,m)
        s2 = solve(m,r)
        return s1+s2
```



#### マージソート

$N$個の整数からなる配列$A (A_{1},A_{2}, \cdots , A_{N})$

1. $k (1 < k <N)$ 個の要素からなる配列に対して、$k/2$個の要素からなる配列$X$,配列$Y$に分割する
2. 配列$X$に対してマージソートを行い、ソートした後の配列を$X'$とする
3. 配列$Y$に対してマージソートを行い、ソートした後の配列を$Y'$とする
4. 配列$X'$と配列$Y'$に対してMerge操作を行うことで$k$個の要素からなる配列がソートされる


###### Merge操作：
ソート済みの２つの配列$A,B$を１つの配列に小さい値順に結合する操作

1. 空の配列$C$を用意する
2. 以下の操作を配列$A,B$のすべての要素が消えるまで繰り返す
    1. 配列$A$が空であれば、配列$B$で最小の要素を配列$C$に移す
    2. 配列$B$が空であれば、配列$A$で最小の要素を配列$C$に移す
    3. 両方の配列が空でなければ、配列$A$に残っている最小の要素と配列$B$に残っている最小の要素を比較し、小さい方を配列$C$に移す


マージソートの計算量は
- Merge操作の計算量→$O(\log_{2}{N})$
- 配列の

より$O(N\log{N})$


**?????なんでreturn 2つあんの？？？？？？？**


#### その他のソートアルゴリズム：
- 挿入ソート：計算量$O(N^{2})$
- クイックソート：計算量$O(N\log{N})$
- 計数ソート：計算量$O(N+B)$

## 3.7 動的計画法〜漸化式の利用〜


#### 漸化式の例

###### 1. 等差数列

$$
\begin{array}{lcl}
a_1 = 1 \\
a_n = a_{n-1} + 2 \space (n \geq 2 ) \\ \\
a_n = 2n - 1 \space (n \geq 1) \texttt{　　(一般項)}
\end{array}
$$

$a_n$を$n$で表したものを**数式の一般項** という

###### 2. フィボナッチ数列
$$
\begin{array}{lcl}
a_1 = 1 \\
a_2 = 1 \\
a_n = a_{n-1} + a_{n-2} \space (n \geq 3 ) \\ \\
a_n = \frac{1}{\sqrt{5}} \times ((\frac{1+\sqrt{5}}{2})^n - (\frac{1-\sqrt{5}}{2})^n) \space  \texttt{　　(一般項)}
\end{array}
$$


###### 3. さらに複雑な漸化式

$$
\begin{array}{lcl}
a_1 = 0 \\
a_2 = 2 \\
a_n = min(a_{n-1} +|h_{n-1} - h_{n}|, a_{n-2}+|h_{n-2}-h_{n}|) \space (n \geq 3 ) \\ \\
\text{ただし、数列}h\text{の最初の５項は}8,6,9,2,1\text{であるとする}
\end{array}
$$


#### 動的計画法


動的計画法：**数列の漸化式のように、前の問題の結果を利用して解くアルゴリズム**

###### 1. カエルの移動

```
問題文
N個の足場があります。足場には1,2,…,Nと番号が振られています。
各i(1≤i≤N) について、足場iの高さはhiです。

最初、足場1にカエルがいます。カエルは次の行動を何回か繰り返し、足場Nまで辿り着こうとしています。

足場iにいるとき、足場i+1 またはi+2 へジャンプする。
このとき、ジャンプ先の足場をjとすると、コスト ∣hi−hj∣ を支払う。
カエルが足場Nに辿り着くまでに支払うコストの総和の最小値を求めてください。

制約
入力はすべて整数である。
2≤N≤10**5
1≤hi≤10**4
```


足場$i$の時点での累計消費体力は
$$
\begin{array}{lcl}
dp[i-1] + |h_{i-1} - h_i| \cdots(1) \\
dp[i-2] = |h_{i-2} - h_i| \cdots(2)
\end{array}
$$
のいずれか


###### 2. 階段の上がり方

```
問題文
太郎君は N段の階段を上ろうとしています。彼は一歩で1段か2段上ることができます。
0段目から出発し、N段目にたどり着くまでの移動方法が何通りあるかを計算してください。

制約
1≤N≤45
Nは整数
```


1. 0段目は$dp[0] = 1$
2. 1段目も$dp[1] = 1$
3. 2段目以降は
    - $n$段目に$n-1$段目から１段で上がる
    - $n$段目に$n-2$段目から２段で上がる

    のいずれかであり、$n$段目までの移動方法はこの２つの和<br>$dp[n] = dp[n-1] + dp[n-2]$で求められる


###### 3. ナップサック問題


```
問題文
N個の品物があります 品物には1,2,…,Nと番号が振られています。 
各i(1≤i≤N)について、品物iの重さはwiで、価値はviです。

太郎君は、N個の品物のうちいくつかを選び、ナップサックに入れて持ち帰ることにしました。 
ナップサックの容量は W であり、持ち帰る品物の重さの総和は W 以下でなければなりません。
太郎君が持ち帰る品物の価値の総和の最大値を求めてください。

制約
入力はすべて整数である。
1≤N≤100
1≤W≤10**5
1≤wi≤W
1≤vi≤10**9
```

方法１：全探索<br>